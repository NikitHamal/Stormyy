<!DOCTYPE html>

<html>

<head>
  <style>
    body {
      margin: 0;
      min-height: 100vh;
      background: #000;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
      perspective: 1000px;
      font-family: 'Poppins', sans-serif;
    }

    .orb-container {
      position: relative;
      width: 200px;
      height: 200px;
      transform-style: preserve-3d;
    }

    .magical-orb {
      position: relative;
      width: 100%;
      height: 100%;
      transform-style: preserve-3d;
      animation: float 4s ease-in-out infinite;
    }

    .orb-inner {
      position: absolute;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, 
        rgb(147, 51, 234),
        rgb(88, 28, 135));
      box-shadow: 0 0 60px rgba(147, 51, 234, 0.4);
      transform-style: preserve-3d;
      animation: pulse 2s ease-in-out infinite;
      transition: background 0.3s, box-shadow 0.3s;
    }
    .data-stream {
      position: absolute;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background: 
        radial-gradient(circle at center, 
          transparent 30%, 
          rgba(0, 255, 255, 0.1) 70%,
          transparent 71%
        );
      animation: dataStream 5s linear infinite;
      transform-style: preserve-3d;
    }

    .energy-ring {
      position: absolute;
      width: 120%;
      height: 120%;
      top: -10%;
      left: -10%;
      border-radius: 50%;
      border: 2px solid rgba(0, 255, 255, 0.3);
      animation: energyRing 6s ease-in-out infinite;
      transform-style: preserve-3d;
    }

    .thunder-wave {
      position: absolute;
      width: 140%;
      height: 140%;
      top: -20%;
      left: -20%;
      border-radius: 50%;
      background: 
        repeating-radial-gradient(
          circle at center,
          transparent 0%,
          rgba(147, 51, 234, 0.1) 2%,
          rgba(167, 71, 254, 0.2) 3%,
          transparent 4%
        );
      filter: blur(1px);
      animation: thunderWave 3s linear infinite;
      mix-blend-mode: screen;
    }

    .eyes-container {
      position: absolute;
      width: 100%;
      height: 100%;
      z-index: 2;
      animation: eyesFloat 4s ease-in-out infinite;
    }

    .eye {
      position: absolute;
      width: 30px;
      height: 30px;
      background: white;
      border-radius: 50%;
      top: 35%;
      animation: blink 4s infinite;
      overflow: hidden;
      transition: transform 0.3s ease-out;
    }

    .eye-left {
      left: 25%;
    }

    .eye-right {
      right: 25%;
    }

    .pupil {
      position: absolute;
      width: 12px;
      height: 12px;
      background: #000;
      border-radius: 50%;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      animation: lookAround 8s infinite;
    }

    @keyframes thunderWave {
      0% {
        transform: scale(0.8) rotate(0deg);
        opacity: 0.3;
      }
      50% {
        transform: scale(1.2) rotate(180deg);
        opacity: 0.8;
      }
      100% {
        transform: scale(0.8) rotate(360deg);
        opacity: 0.3;
      }
    }

    @keyframes float {
      0%, 100% { transform: translateY(-10px); }
      50% { transform: translateY(10px); }
    }

    @keyframes blink {
      0%, 48%, 52%, 100% { transform: scaleY(1); }
      50% { transform: scaleY(0.1); }
    }

    @keyframes lookAround {
      0%, 100% { transform: translate(-50%, -50%); }
      15% { transform: translate(-100%, -50%); }
      30% { transform: translate(-50%, -100%); }
      45% { transform: translate(0%, -50%); }
      60% { transform: translate(-50%, 0%); }
      75% { transform: translate(-50%, -50%); }
    }

    @keyframes eyesFloat {
      0%, 100% { transform: translateY(-5px); }
      50% { transform: translateY(5px); }
    }

    /* Add new chat interface styles */
    .chat-container {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      width: 400px;
      background: rgba(147, 51, 234, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 15px;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease-out;
      z-index: 1000;
    }

    .chat-container.visible {
      opacity: 1;
      pointer-events: all;
    }

    .input-group {
      display: flex;
      gap: 10px;
    }

    .chat-input {
      flex: 1;
      padding: 12px;
      border: none;
      border-radius: 15px;
      background: rgba(0, 0, 0, 0.7);
      color: white;
      font-size: 16px;
      transition: background 0.3s;
    }

    .chat-input:focus {
      background: rgba(0, 0, 0, 0.9);
      outline: none;
    }

    .send-button {
      padding: 12px 20px;
      border: none;
      border-radius: 15px;
      background: rgb(147, 51, 234);
      color: white;
      cursor: pointer;
      transition: all 0.3s;
    }

    .send-button:hover {
      background: rgb(167, 71, 254);
    }

    /* New animations */
    @keyframes thinking {
      0% { transform: rotate(0deg) scale(1) translateY(0px); }
      25% { transform: rotate(5deg) scale(1.1) translateY(-5px); }
      75% { transform: rotate(-5deg) scale(0.9) translateY(5px); }
      100% { transform: rotate(0deg) scale(1) translateY(0px); }
    }

    .thinking .magical-orb {
      animation: thinking 1.5s ease-in-out infinite !important;
    }

    .thinking .thunder-wave {
      animation: thunderWave 2s linear infinite;
      opacity: 0.8;
    }

    .response-received .orb-inner {
      animation: pulse 1s ease-in-out;
      box-shadow: 0 0 100px rgba(147, 51, 234, 0.8);
    }

    /* Add these new styles after the existing styles */
    .speech-bubble {
      position: absolute;
      top: -80px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(147, 51, 234, 0.3);
      backdrop-filter: blur(10px);
      padding: 15px 20px;
      border-radius: 20px;
      max-width: 300px;
      min-width: 150px;
      color: white;
      font-size: 14px;
      opacity: 0;
      transition: all 0.3s;
      pointer-events: none;
      z-index: 1000;
      text-align: center;
      box-shadow: 0 0 20px rgba(147, 51, 234, 0.2);
      display: block;
    }

    .speech-bubble::after {
      content: '';
      position: absolute;
      bottom: -10px;
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 0;
      border-left: 10px solid transparent;
      border-right: 10px solid transparent;
      border-top: 12px solid rgba(147, 51, 234, 0.3);
    }

    .speech-bubble.active {
      opacity: 1;
      top: -100px;
      transform: translateX(-50%) scale(1);
      visibility: visible;
    }

    .speech-bubble.thinking {
      content: 'Thinking...';
    }

    .thinking-dots {
      display: none;
      justify-content: center;
      gap: 4px;
      margin-top: 10px;
    }

    .dot {
      width: 8px;
      height: 8px;
      background: rgb(147, 51, 234);
      border-radius: 50%;
      opacity: 0.6;
    }

    .thinking .thinking-dots {
      display: flex;
    }

    .thinking .dot {
      animation: dotPulse 1.4s infinite;
    }

    .thinking .dot:nth-child(2) {
      animation-delay: 0.2s;
    }

    .thinking .dot:nth-child(3) {
      animation-delay: 0.4s;
    }

    @keyframes dotPulse {
      0%, 100% { transform: scale(1); opacity: 0.6; }
      50% { transform: scale(1.5); opacity: 1; }
    }

    /* Click animation for the orb */
    @keyframes clickPulse {
      0% { transform: scale(1); }
      50% { transform: scale(0.95); }
      100% { transform: scale(1); }
    }

    .orb-click {
      animation: clickPulse 0.3s ease-out;
    }

    /* Enhance existing animations */
    @keyframes thinking {
      0% { 
        transform: rotate(0deg) scale(1) translateY(0px);
        filter: brightness(1);
      }
      25% { 
        transform: rotate(5deg) scale(1.1) translateY(-5px);
        filter: brightness(1.2);
      }
      75% { 
        transform: rotate(-5deg) scale(0.9) translateY(5px);
        filter: brightness(0.9);
      }
      100% { 
        transform: rotate(0deg) scale(1) translateY(0px);
        filter: brightness(1);
      }
    }

    /* Responsive design */
    @media (max-width: 768px) {
      .orb-container {
        width: 150px;
        height: 150px;
      }

      .chat-container {
        width: 90%;
        max-width: 400px;
      }

      .speech-bubble {
        width: 80%;
        max-width: 300px;
        font-size: 12px;
      }

      .eye {
        width: 25px;
        height: 25px;
      }

      .pupil {
        width: 10px;
        height: 10px;
      }
    }

    @media (max-width: 480px) {
      .orb-container {
        width: 120px;
        height: 120px;
      }

      .chat-container {
        padding: 10px;
      }

      .chat-input {
        font-size: 14px;
      }

      .send-button {
        padding: 8px 15px;
      }
    }

    /* Add new chat history styles */
    .chat-history {
      max-height: 200px;
      overflow-y: auto;
      margin-bottom: 10px;
      padding: 10px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 15px;
      display: none;
    }

    .chat-message {
      margin: 8px 0;
      padding: 8px 12px;
      border-radius: 12px;
      max-width: 80%;
    }

    .user-message {
      background: rgba(147, 51, 234, 0.3);
      margin-left: auto;
      color: white;
    }

    .bot-message {
      background: rgba(255, 255, 255, 0.1);
      margin-right: auto;
      color: white;
    }

    .chat-container.expanded .chat-history {
      display: block;
    }

    /* Add these styles to the existing <style> section */
    .chat-history-icon {
      position: fixed;
      top: 20px;
      right: 20px;
      width: 50px;
      height: 50px;
      background: rgba(147, 51, 234, 0.2);
      backdrop-filter: blur(10px);
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      transition: transform 0.3s, background 0.3s;
      z-index: 1000;
    }

    .chat-history-icon:hover {
      transform: scale(1.1);
      background: rgba(147, 51, 234, 0.3);
    }

    .chat-history-icon svg {
      width: 24px;
      height: 24px;
      fill: white;
    }

    /* Remove the chat history styles */
    .chat-history {
      display: none;
    }

    /* Add idle message style */
    .idle-message {
      position: absolute;
      top: -60px;
      left: 50%;
      transform: translateX(-50%);
      color: rgba(255, 255, 255, 0.7);
      font-size: 14px;
      opacity: 0;
      transition: opacity 0.3s;
      text-align: center;
      pointer-events: none;
    }

    .idle-message.visible {
      opacity: 1;
    }

    /* Add a subtle glow effect when visible */
    .chat-container.visible .input-group {
      animation: fadeIn 0.3s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Add microphone icon styles */
    .mic-icon {
      position: absolute;
      right: 60px;
      top: 50%;
      transform: translateY(-50%);
      width: 24px;
      height: 24px;
      cursor: pointer;
      fill: white;
      opacity: 0.7;
      transition: opacity 0.3s;
    }

    .mic-icon:hover {
      opacity: 1;
    }

    .mic-icon.listening {
      animation: pulseRed 1.5s infinite;
    }

    @keyframes pulseRed {
      0% { fill: white; }
      50% { fill: #ff4444; }
      100% { fill: white; }
    }

    /* Remove the mic-icon styles and add orb listening state styles */
    .orb-container.listening .magical-orb {
      animation: listeningPulse 1.5s infinite !important;
    }

    .orb-container.listening .thunder-wave {
      animation: thunderWave 1.5s linear infinite;
      opacity: 0.9;
      filter: hue-rotate(45deg);
    }

    @keyframes listeningPulse {
      0% { transform: scale(1); filter: brightness(1); }
      50% { transform: scale(1.05); filter: brightness(1.2); }
      100% { transform: scale(1); filter: brightness(1); }
    }

    /* Update speech bubble styles for listening state */
    .speech-bubble.listening {
      background: rgba(255, 68, 68, 0.3);
    }

    .speech-bubble.listening::after {
      border-top-color: rgba(255, 68, 68, 0.3);
    }

    /* Add these styles for the keyboard icon */
    .keyboard-icon {
      position: fixed;
      top: 20px;
      left: 20px;
      width: 50px;
      height: 50px;
      background: rgba(147, 51, 234, 0.2);
      backdrop-filter: blur(10px);
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      transition: transform 0.3s, background 0.3s;
      z-index: 1000;
    }

    .keyboard-icon:hover {
      transform: scale(1.1);
      background: rgba(147, 51, 234, 0.3);
    }

    .keyboard-icon svg {
      width: 24px;
      height: 24px;
      fill: white;
    }

    .keyboard-icon.active {
      background: rgba(147, 51, 234, 0.4);
      transform: scale(0.95);
    }
    .caption-container {
      position: absolute;
      top: -40px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(147, 51, 234, 0.2);
      padding: 8px 16px;
      border-radius: 12px;
      opacity: 0;
      transition: opacity 0.3s;
      pointer-events: none;
    }

    .caption-text {
      color: white;
      font-size: 14px;
      text-align: center;
    }

    /* Add emotion styles with !important to override default state */
    .orb-container[data-emotion="happy"] .orb-inner {
      background: radial-gradient(circle at 30% 30%, 
        rgb(255, 189, 89),
        rgb(255, 145, 48)) !important;
      box-shadow: 0 0 60px rgba(255, 166, 0, 0.4) !important;
    }

    .orb-container[data-emotion="sad"] .orb-inner {
      background: radial-gradient(circle at 30% 30%, 
        rgb(100, 181, 246),
        rgb(30, 136, 229)) !important;
      box-shadow: 0 0 60px rgba(30, 136, 229, 0.4) !important;
    }

    .orb-container[data-emotion="angry"] .orb-inner {
      background: radial-gradient(circle at 30% 30%, 
        rgb(255, 82, 82),
        rgb(211, 47, 47)) !important;
      box-shadow: 0 0 60px rgba(211, 47, 47, 0.4) !important;
    }

    .orb-container[data-emotion="confused"] .orb-inner {
      background: radial-gradient(circle at 30% 30%, 
        rgb(171, 71, 188),
        rgb(142, 36, 170)) !important;
      box-shadow: 0 0 60px rgba(142, 36, 170, 0.4) !important;
    }

    /* Update eye styles to handle emotions */
    .eye {
      position: absolute;
      width: 30px;
      height: 30px;
      background: white;
      border-radius: 50%;
      top: 35%;
      animation: blink 4s infinite;
      overflow: hidden;
      transition: transform 0.3s ease-out;
    }

    /* Add emotion-specific eye animations with !important */
    .orb-container[data-emotion="happy"] .eye {
      transform: scale(1.1) translateY(-2px) !important;
    }

    .orb-container[data-emotion="sad"] .eye {
      transform: scale(0.9) translateY(2px) !important;
    }

    .orb-container[data-emotion="angry"] .eye {
      transform: scaleY(0.8) !important;
    }

    .orb-container[data-emotion="confused"] .eye-left {
      transform: translateY(-2px) !important;
    }

    .orb-container[data-emotion="confused"] .eye-right {
      transform: translateY(2px) !important;
    }

    /* Add these emotion-specific animations */
    @keyframes happyBounce {
      0%, 100% { transform: translateY(-10px) scale(1); }
      50% { transform: translateY(10px) scale(1.1); }
    }

    @keyframes sadDroop {
      0%, 100% { transform: translateY(0) scale(1); }
      50% { transform: translateY(15px) scale(0.95); }
    }

    @keyframes angryShake {
      0%, 100% { transform: translateX(0) scale(1); }
      25% { transform: translateX(-5px) scale(1.05); }
      75% { transform: translateX(5px) scale(1.05); }
    }

    @keyframes confusedSpin {
      0% { transform: rotate(-5deg) scale(1); }
      50% { transform: rotate(5deg) scale(0.95); }
      100% { transform: rotate(-5deg) scale(1); }
    }

    /* Add thunder effects for angry state */
    @keyframes angryThunder {
      0% { opacity: 0.3; transform: scale(0.8); }
      50% { opacity: 1; transform: scale(1.3); }
      51% { opacity: 0.3; transform: scale(0.8); }
      100% { opacity: 0.3; transform: scale(0.8); }
    }

    /* Update emotion styles with animations */
    .orb-container[data-emotion="happy"] .magical-orb {
      animation: happyBounce 2s ease-in-out infinite !important;
    }

    .orb-container[data-emotion="happy"] .thunder-wave {
      opacity: 0.6;
      filter: hue-rotate(280deg) brightness(1.5);
    }

    .orb-container[data-emotion="sad"] .magical-orb {
      animation: sadDroop 3s ease-in-out infinite !important;
    }

    .orb-container[data-emotion="sad"] .thunder-wave {
      opacity: 0.3;
      filter: hue-rotate(180deg);
    }

    .orb-container[data-emotion="angry"] .magical-orb {
      animation: angryShake 0.5s ease-in-out infinite !important;
    }

    .orb-container[data-emotion="angry"] .thunder-wave {
      animation: angryThunder 1s linear infinite !important;
      filter: hue-rotate(320deg) brightness(1.5);
    }

    .orb-container[data-emotion="confused"] .magical-orb {
      animation: confusedSpin 3s ease-in-out infinite !important;
    }

    .orb-container[data-emotion="confused"] .thunder-wave {
      animation: thunderWave 4s linear infinite reverse;
      filter: hue-rotate(90deg);
    }

    /* Add particle effects for emotional states */
    .emotion-particles {
      position: absolute;
      width: 100%;
      height: 100%;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.3s;
    }

    .orb-container[data-emotion] .emotion-particles {
      opacity: 1;
    }

    @keyframes particleFloat {
      0% { transform: translateY(0) scale(1); opacity: 1; }
      100% { transform: translateY(-50px) scale(0); opacity: 0; }
    }

    .particle {
      position: absolute;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      animation: particleFloat 2s ease-out forwards;
    }

    /* Add this to the existing eye animations */
    .orb-container[data-emotion="happy"] .pupil {
      animation: happyPupils 3s ease-in-out infinite !important;
    }

    .orb-container[data-emotion="sad"] .pupil {
      animation: sadPupils 3s ease-in-out infinite !important;
    }

    .orb-container[data-emotion="angry"] .pupil {
      animation: angryPupils 1s ease-in-out infinite !important;
    }

    .orb-container[data-emotion="confused"] .pupil {
      animation: confusedPupils 3s linear infinite !important;
    }

    @keyframes happyPupils {
      0%, 100% { transform: translate(-50%, -50%) scale(1); }
      50% { transform: translate(-50%, -50%) scale(1.2); }
    }

    @keyframes sadPupils {
      0%, 100% { transform: translate(-50%, -50%); }
      50% { transform: translate(-50%, 0%); }
    }

    @keyframes angryPupils {
      0%, 100% { transform: translate(-50%, -50%) scaleY(0.8); }
      50% { transform: translate(-50%, -50%) scaleY(1.2); }
    }

    @keyframes confusedPupils {
      0% { transform: translate(-100%, -50%); }
      25% { transform: translate(-50%, -100%); }
      50% { transform: translate(0%, -50%); }
      75% { transform: translate(-50%, 0%); }
      100% { transform: translate(-100%, -50%); }
    }

    /* Thunderbolt icon styles */
    .thunderbolt-icon {
      position: fixed;
      top: 20px;
      left: 80px; /* Position it next to keyboard icon */
      width: 50px;
      height: 50px;
      background: rgba(255, 215, 0, 0.2);
      backdrop-filter: blur(10px);
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      transition: transform 0.3s, background 0.3s;
      z-index: 1000;
    }

    .thunderbolt-icon:hover {
      transform: scale(1.1);
      background: rgba(255, 215, 0, 0.3);
    }

    .thunderbolt-icon svg {
      width: 24px;
      height: 24px;
      fill: #FFD700;
    }

    .thunderbolt-icon.active {
      background: rgba(255, 215, 0, 0.4);
      transform: scale(0.95);
    }

    /* Lightning effect styles */
    .lightning-effect {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      opacity: 0;
      z-index: 10;
    }

    .lightning-effect.active {
      animation: lightningFlash 0.5s ease-out;
    }

    @keyframes lightningFlash {
      0% {
        opacity: 0;
      }
      25% {
        opacity: 1;
        background: linear-gradient(45deg, 
          rgba(255, 255, 255, 0.8),
          rgba(255, 215, 0, 0.8)
        );
      }
      50% {
        opacity: 0;
      }
      75% {
        opacity: 1;
        background: linear-gradient(-45deg,
          rgba(255, 255, 255, 0.6),
          rgba(255, 215, 0, 0.6)
        );
      }
      100% {
        opacity: 0;
      }
    }

    /* Hurt animation styles */
    @keyframes hurtShake {
      0%, 100% { transform: translate(0, 0) scale(1); }
      25% { transform: translate(-10px, 5px) scale(0.95); }
      50% { transform: translate(8px, -4px) scale(0.97); }
      75% { transform: translate(-6px, 3px) scale(0.98); }
    }

    @keyframes hurtEyes {
      0%, 100% { transform: scaleY(1); }
      50% { transform: scaleY(0.2); }
    }

    .orb-container.hurt .magical-orb {
      animation: hurtShake 0.5s ease-out !important;
    }

    .orb-container.hurt .eye {
      animation: hurtEyes 0.5s ease-out !important;
    }

    .orb-container.hurt .thunder-wave {
      animation: thunderWave 0.5s linear infinite !important;
      opacity: 1 !important;
      filter: hue-rotate(180deg) brightness(1.5) !important;
    }

    /* Add hurt state styles */
    .orb-container.hurt .orb-inner {
      background: radial-gradient(circle at 30% 30%, 
        rgb(255, 165, 0),
        rgb(255, 69, 0)) !important;
      box-shadow: 0 0 60px rgba(255, 69, 0, 0.6) !important;
    }

    /* Add these new icon styles */
    .tickle-icon, .love-icon, .dizzy-icon {
      position: fixed;
      width: 50px;
      height: 50px;
      background: rgba(147, 51, 234, 0.2);
      backdrop-filter: blur(10px);
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      transition: transform 0.3s, background 0.3s;
      z-index: 1000;
    }

    .tickle-icon {
      top: 20px;
      left: 140px;
      background: rgba(255, 182, 193, 0.2);
    }

    .love-icon {
      top: 20px;
      left: 200px;
      background: rgba(255, 105, 180, 0.2);
    }

    .dizzy-icon {
      top: 20px;
      left: 260px;
      background: rgba(138, 43, 226, 0.2);
    }

    .tickle-icon:hover, .love-icon:hover, .dizzy-icon:hover {
      transform: scale(1.1);
    }

    .tickle-icon svg, .love-icon svg, .dizzy-icon svg {
      width: 24px;
      height: 24px;
      fill: white;
    }

    /* Add new animation keyframes */
    @keyframes tickle {
      0%, 100% { transform: rotate(0) scale(1); }
      25% { transform: rotate(15deg) scale(1.1); }
      50% { transform: rotate(-15deg) scale(0.9); }
      75% { transform: rotate(10deg) scale(1.05); }
    }

    @keyframes love {
      0% { transform: scale(1); }
      25% { transform: scale(1.2); }
      50% { transform: scale(0.95); }
      75% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }

    @keyframes dizzy {
      0% { transform: rotate(0) scale(1); }
      100% { transform: rotate(360deg) scale(1); }
    }

    @keyframes heartBeat {
      0% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.5); opacity: 0; }
      100% { transform: scale(2); opacity: 0; }
    }

    /* Add heart particles style */
    .heart-particle {
      position: absolute;
      width: 20px;
      height: 20px;
      background: pink;
      clip-path: path('M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z');
      animation: heartBeat 1s forwards;
    }

    /* Add stars for dizzy effect */
    .star-particle {
      position: absolute;
      width: 15px;
      height: 15px;
      background: yellow;
      clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
      animation: starSpin 1s linear infinite;
    }

    @keyframes starSpin {
      0% { transform: rotate(0) scale(1); opacity: 1; }
      100% { transform: rotate(360deg) scale(0); opacity: 0; }
    }

    /* Add dizzy eyes animation */
    @keyframes dizzyEyes {
      0% { transform: rotate(0) translateX(0); }
      100% { transform: rotate(360deg) translateX(5px); }
    }

    .orb-container.dizzy .pupil {
      animation: dizzyEyes 0.5s linear infinite !important;
    }

    /* Add tickle eyes animation */
    @keyframes tickleEyes {
      0%, 100% { transform: translate(-50%, -50%); }
      25% { transform: translate(-30%, -60%); }
      50% { transform: translate(-70%, -40%); }
      75% { transform: translate(-40%, -30%); }
    }

    .orb-container.tickled .pupil {
      animation: tickleEyes 0.3s linear infinite !important;
    }

    /* Add love eyes animation */
    @keyframes loveEyes {
      0%, 100% { clip-path: none; background: white; }
      50% { 
        clip-path: path('M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z');
        background: pink;
      }
    }

    .orb-container.loved .eye {
      animation: loveEyes 0.5s ease-in-out infinite !important;
    }

    /* Add these new interaction icons */
    .sleep-icon, .party-icon, .sneeze-icon {
      position: fixed;
      width: 50px;
      height: 50px;
      backdrop-filter: blur(10px);
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      transition: transform 0.3s, background 0.3s;
      z-index: 1000;
    }

    .sleep-icon {
      top: 20px;
      left: 320px;
      background: rgba(70, 130, 180, 0.2);
    }

    .party-icon {
      top: 20px;
      left: 380px;
      background: rgba(255, 69, 0, 0.2);
    }

    .sneeze-icon {
      top: 20px;
      left: 440px;
      background: rgba(144, 238, 144, 0.2);
    }

    /* Add new animations */
    @keyframes sleep {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(5px); }
    }

    @keyframes snore {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }

    @keyframes party {
      0% { transform: rotate(0) scale(1); filter: hue-rotate(0deg); }
      25% { transform: rotate(15deg) scale(1.1); filter: hue-rotate(90deg); }
      50% { transform: rotate(-15deg) scale(0.9); filter: hue-rotate(180deg); }
      75% { transform: rotate(10deg) scale(1.05); filter: hue-rotate(270deg); }
      100% { transform: rotate(0) scale(1); filter: hue-rotate(360deg); }
    }

    @keyframes sneeze {
      0% { transform: scale(1) rotate(0); }
      25% { transform: scale(1.1) rotate(-5deg); }
      50% { transform: scale(0.9) rotate(5deg); }
      75% { transform: scale(1.2) rotate(-10deg); }
      90% { transform: scale(0.8) rotate(10deg); }
      100% { transform: scale(1) rotate(0); }
    }

    /* Add sleeping Z's animation */
    @keyframes floatingZ {
      0% { transform: translate(0, 0) rotate(0) scale(1); opacity: 1; }
      100% { transform: translate(-50px, -50px) rotate(20deg) scale(0); opacity: 0; }
    }

    .z-particle {
      position: absolute;
      font-family: 'Arial', sans-serif;
      font-size: 24px;
      font-weight: bold;
      color: rgba(70, 130, 180, 0.8);
      animation: floatingZ 2s ease-out forwards;
    }

    /* Add party confetti */
    .confetti {
      position: absolute;
      width: 10px;
      height: 10px;
      animation: confettiFall 3s linear forwards;
    }

    @keyframes confettiFall {
      0% { transform: translateY(0) rotate(0) scale(1); opacity: 1; }
      100% { transform: translateY(100vh) rotate(720deg) scale(0); opacity: 0; }
    }

    /* Add sneeze particles */
    .sneeze-droplet {
      position: absolute;
      width: 8px;
      height: 8px;
      background: rgba(144, 238, 144, 0.6);
      border-radius: 50%;
      animation: sneezeSpray 1s ease-out forwards;
    }

    @keyframes sneezeSpray {
      0% { transform: scale(1) translateX(0); opacity: 1; }
      100% { transform: scale(0) translateX(100px); opacity: 0; }
    }

    /* Add sleeping eyes animation */
    @keyframes sleepyEyes {
      0%, 100% { transform: scaleY(1); }
      50% { transform: scaleY(0.1); }
    }

    .orb-container.sleeping .eye {
      animation: sleepyEyes 3s ease-in-out infinite !important;
    }

    /* Add party eyes animation */
    @keyframes partyEyes {
      0% { background: red; }
      33% { background: green; }
      66% { background: blue; }
      100% { background: red; }
    }

    .orb-container.partying .eye {
      animation: partyEyes 1s linear infinite !important;
    }

    /* Add sneeze eyes animation */
    @keyframes sneezeEyes {
      0% { transform: scaleY(1); }
      50% { transform: scaleY(0.1) rotate(10deg); }
      100% { transform: scaleY(1); }
    }

    .orb-container.sneezing .eye {
      animation: sneezeEyes 0.5s ease-out !important;
    }

    /* Add these new lightning bolt styles */
    .lightning-bolt {
      position: absolute;
      top: 0;
      left: 50%;
      width: 4px;
      height: 0;
      background: linear-gradient(to bottom, 
        rgba(255, 255, 255, 0.9),
        rgba(255, 215, 0, 0.8)
      );
      transform: translateX(-50%);
      z-index: 100;
      filter: drop-shadow(0 0 10px rgba(255, 215, 0, 0.8));
      opacity: 0;
    }

    .lightning-bolt.active {
      animation: lightningStrike 0.5s ease-out;
    }

    .lightning-branches {
      position: absolute;
      width: 100%;
      height: 100%;
      opacity: 0;
    }

    .lightning-branch {
      position: absolute;
      background: rgba(255, 215, 0, 0.6);
      height: 2px;
      transform-origin: left center;
    }

    .lightning-branches.active {
      animation: branchFade 0.5s ease-out;
    }

    @keyframes lightningStrike {
      0% {
        height: 0;
        opacity: 0;
      }
      10% {
        opacity: 1;
      }
      20% {
        height: 20vh;
      }
      30% {
        height: 15vh;
      }
      40% {
        height: 40vh;
      }
      50% {
        height: 35vh;
      }
      60% {
        height: 50vh;
      }
      70% {
        height: 45vh;
      }
      80% {
        height: 100vh;
        opacity: 1;
      }
      100% {
        height: 100vh;
        opacity: 0;
      }
    }

    @keyframes branchFade {
      0% {
        opacity: 0;
      }
      20% {
        opacity: 0.8;
      }
      40% {
        opacity: 0.4;
      }
      60% {
        opacity: 0.6;
      }
      80% {
        opacity: 0.2;
      }
      100% {
        opacity: 0;
      }
    }

    /* Add thunder flash effect */
    .thunder-flash {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: white;
      opacity: 0;
      pointer-events: none;
      z-index: 99;
    }

    .thunder-flash.active {
      animation: thunderFlash 0.5s ease-out;
    }

    @keyframes thunderFlash {
      0% {
        opacity: 0;
      }
      10% {
        opacity: 0.8;
      }
      20% {
        opacity: 0;
      }
      30% {
        opacity: 0.6;
      }
      40% {
        opacity: 0;
      }
      50% {
        opacity: 0.4;
      }
      100% {
        opacity: 0;
      }
    }

    /* Add rain effect */
    .rain-drop {
      position: fixed;
      width: 2px;
      height: 10px;
      background: rgba(255, 255, 255, 0.5);
      animation: rainFall linear infinite;
    }

    @keyframes rainFall {
      0% {
        transform: translateY(-100vh) rotate(20deg);
      }
      100% {
        transform: translateY(100vh) rotate(20deg);
      }
    }
  </style>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
</head>
<body>
  <!-- Original orb structure -->
  <div id="orb-container" class="orb-container">
    <div class="magical-orb">
      <div class="thunder-wave"></div>
      <div class="thunder-wave" style="animation-delay: -1.5s"></div>
      <div class="orb-inner"></div>
      <div class="eyes-container">
        <div class="eye eye-left">
          <div class="pupil"></div>
        </div>
        <div class="eye eye-right">
          <div class="pupil"></div>
        </div>
      </div>
      <div class="emotion-particles"></div>
      <div class="lightning-effect"></div>
    </div>
  </div>

  <!-- Add this after the orb structure but before the chat container -->
  <div class="speech-bubble" id="speechBubble"></div>

  <!-- Add this after the orb structure -->
  <div class="idle-message" id="idleMessage">Click me to chat!</div>

  <!-- Add this after the orb container but before the chat container -->
  <div class="keyboard-icon" id="keyboardIcon" title="Toggle keyboard input">
    <svg viewBox="0 0 24 24">
      <path d="M20,5H4C2.9,5,2,5.9,2,7v10c0,1.1,0.9,2,2,2h16c1.1,0,2-0.9,2-2V7C22,5.9,21.1,5,20,5z M20,17H4V7h16V17z"/>
      <path d="M11,8h2v2h-2V8z"/>
      <path d="M8,8h2v2H8V8z"/>
      <path d="M5,8h2v2H5V8z"/>
      <path d="M14,8h2v2h-2V8z"/>
      <path d="M17,8h2v2h-2V8z"/>
      <path d="M8,11h2v2H8V11z"/>
      <path d="M11,11h2v2h-2V11z"/>
      <path d="M14,11h2v2h-2V11z"/>
      <path d="M17,11h2v2h-2V11z"/>
      <path d="M8,14h8v2H8V14z"/>
    </svg>
  </div>

  <!-- Add this after the keyboard icon but before the chat container -->
  <div class="thunderbolt-icon" id="thunderboltIcon" title="Strike with lightning">
    <svg viewBox="0 0 24 24">
      <path d="M7 2v11h3v9l7-12h-4l4-8z"/>
    </svg>
  </div>

  <!-- Add this before the chat container -->
  <a href="chat-history.html" class="chat-history-icon" title="View Chat History">
    <svg viewBox="0 0 24 24">
      <path d="M20,2H4C2.9,2,2,2.9,2,4v18l4-4h14c1.1,0,2-0.9,2-2V4C22,2.9,21.1,2,20,2z M20,16H6l-2,2V4h16V16z"/>
    </svg>
  </a>

  <!-- Update the chat container to remove chat history -->
  <div class="chat-container" id="chatContainer">
    <div class="input-group">
      <input type="text" class="chat-input" id="userInput" placeholder="Ask Stormy anything...">
      <button class="send-button" id="sendButton">Send</button>
    </div>
  </div>

  <div id="captionContainer" class="caption-container">
    <div class="caption-text"></div>
  </div>

  <!-- Add these new icons after the thunderbolt icon -->
  <div class="tickle-icon" id="tickleIcon" title="Tickle the orb">
    <svg viewBox="0 0 24 24">
      <path d="M19.59 7L12 14.59 6.41 9H10V7H3v7h2V9.41L12 16.41 19.59 9H16V7h7v7h-2V9.41L14.41 16 21 22.59 19.59 21 13 14.41 6.41 21 5 22.59 6.41 16 13z"/>
    </svg>
  </div>

  <div class="love-icon" id="loveIcon" title="Show some love">
    <svg viewBox="0 0 24 24">
      <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
    </svg>
  </div>

  <div class="dizzy-icon" id="dizzyIcon" title="Make the orb dizzy">
    <svg viewBox="0 0 24 24">
      <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"/>
      <path d="M15 16H9v-2h6v2zm0-4H9v-2h6v2zm0-4H9V6h6v2z"/>
    </svg>
  </div>

  <!-- Add these new interaction icons -->
  <div class="sleep-icon" id="sleepIcon" title="Make the orb sleepy">
    <svg viewBox="0 0 24 24">
      <path d="M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36c-0.98,1.37-2.58,2.26-4.4,2.26 c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"/>
    </svg>
  </div>

  <div class="party-icon" id="partyIcon" title="Start a party!">
    <svg viewBox="0 0 24 24">
      <path d="M2,22l14-14L14,6l-2,2l-2-2L8,8l-2-2L4,8L2,22z M14,6l8-4l-4,8L14,6z"/>
    </svg>
  </div>

  <div class="sneeze-icon" id="sneezeIcon" title="Make the orb sneeze">
    <svg viewBox="0 0 24 24">
      <path d="M12,2C6.47,2,2,6.47,2,12s4.47,10,10,10s10-4.47,10-10S17.53,2,12,2z M12,20c-4.41,0-8-3.59-8-8s3.59-8,8-8s8,3.59,8,8 S16.41,20,12,20z"/>
      <path d="M9.59,8.59L12,11l2.41-2.41L16,10l-4,4l-4-4L9.59,8.59z"/>
    </svg>
  </div>
</div>

  <!-- Add these elements after the lightning-effect div -->
  <div class="lightning-bolt"></div>
  <div class="lightning-branches"></div>
  <div class="thunder-flash"></div>

  <script>
    // Original orb interaction code
    const orbContainer = document.getElementById('orb-container');
    const pupils = document.querySelectorAll('.pupil');
    let isDragging = false;
    let currentX;
    let currentY;
    let initialX;
    let initialY;
    let xOffset = 0;
    let yOffset = 0;
    let lastMovementTime = 0;
    const idleThreshold = 500;

    // Chat functionality
    const chatContainer = document.getElementById('chatContainer');
    const userInput = document.getElementById('userInput');
    const sendButton = document.getElementById('sendButton');
    const magicalOrb = document.querySelector('.magical-orb');

    // Toggle chat on orb click
    orbContainer.addEventListener('click', () => {
      if (!isDragging) {
        if (!isListening && recognition) {
          // Start listening
          recognition.start();
          chatContainer.classList.remove('visible');
          keyboardIcon.classList.remove('active');
        } else if (isListening) {
          // Stop listening
          recognition.stop();
        }
        idleMessage.classList.remove('visible');
      }
    });

    // API configuration
    const API_KEY = 'AIzaSyBlvhpuRx-ispBO9mCxnMNu78FQ4rLnmrI'; // Replace with your actual API key
    const API_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent';

    // Add these functions to the script section
    function showCaption(text) {
      const captionContainer = document.getElementById('captionContainer');
      const captionText = captionContainer.querySelector('.caption-text');
      captionText.textContent = text;
      captionContainer.style.opacity = '1';
    }

    function hideCaption() {
      const captionContainer = document.getElementById('captionContainer');
      captionContainer.style.opacity = '0';
    }

    // Add click animation
    orbContainer.addEventListener('mousedown', () => {
      magicalOrb.classList.add('orb-click');
    });

    orbContainer.addEventListener('mouseup', () => {
      magicalOrb.classList.remove('orb-click');
    });

    // Add this function to store messages
    function saveMessage(text, type) {
      const history = JSON.parse(localStorage.getItem('stormyChatHistory') || '[]');
      history.push({
        text,
        type,
        timestamp: new Date().toISOString()
      });
      localStorage.setItem('stormyChatHistory', JSON.stringify(history));
    }

    // Initialize speech synthesis and get voices
    let speechSynthesis = window.speechSynthesis;
    let voices = [];

    function loadVoices() {
      voices = speechSynthesis.getVoices();
    }

    // Load voices when they're available
    if (speechSynthesis.onvoiceschanged !== undefined) {
      speechSynthesis.onvoiceschanged = loadVoices;
    }

    // Add these functions to handle speech recognition
    let recognition;
    let isListening = false;

    function initSpeechRecognition() {
      if ('webkitSpeechRecognition' in window) {
        recognition = new webkitSpeechRecognition();
        recognition.continuous = false;
        recognition.interimResults = false;
        recognition.lang = 'en-US';

        recognition.onstart = () => {
          orbContainer.classList.add('listening');
          speechBubble.textContent = "I'm listening...";
          speechBubble.classList.add('active', 'listening');
          isListening = true;
        };

        recognition.onresult = (event) => {
          const transcript = event.results[0][0].transcript;
          orbContainer.classList.remove('listening');
          speechBubble.classList.remove('listening');
          handleUserInput(transcript);
        };

        recognition.onend = () => {
          orbContainer.classList.remove('listening');
          speechBubble.classList.remove('active', 'listening');
          isListening = false;
        };

        recognition.onerror = (event) => {
          console.error('Speech recognition error:', event.error);
          orbContainer.classList.remove('listening');
          speechBubble.textContent = "Sorry, I couldn't hear that.";
          speechBubble.classList.remove('listening');
          setTimeout(() => speechBubble.classList.remove('active'), 2000);
          isListening = false;
        };
      }
    }

    // Initialize speech recognition
    initSpeechRecognition();

    // Update the handleUserInput function to better handle text processing
    function cleanTextForSpeech(text) {
      // Remove emojis
      text = text.replace(/([\u2700-\u27BF]|[\uE000-\uF8FF]|\uD83C[\uDC00-\uDFFF]|\uD83D[\uDC00-\uDFFF]|[\u2011-\u26FF]|\uD83E[\uDD10-\uDDFF])/g, '');
      
      // Remove markdown and code blocks
      text = text.replace(/```[\s\S]*?```/g, '')
                .replace(/`.*?`/g, '')
                .replace(/\*\*(.*?)\*\*/g, '$1')
                .replace(/\*(.*?)\*/g, '$1')
                .replace(/#+ /g, '')
                .trim();
      
      // Add proper punctuation for better speech
      text = text.replace(/([.!?])(\w)/g, '$1 $2');
      
      return text;
    }

    // Update the speech synthesis part in handleUserInput
    async function handleUserInput(directInput) {
      const prompt = directInput || userInput.value.trim();
      if (!prompt) return;

      saveMessage(prompt, 'user');
      if (!directInput) userInput.value = '';

      const speechBubble = document.getElementById('speechBubble');
      speechBubble.textContent = "Thinking...";
      speechBubble.classList.add('active');
      
      orbContainer.setAttribute('data-emotion', 'neutral');
      magicalOrb.parentElement.classList.add('thinking');
      userInput.disabled = true;
      sendButton.disabled = true;

      try {
        const response = await fetch(`${API_URL}?key=${API_KEY}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            contents: [{
              parts: [{
                text: `You are Stormy, an emotional AI companion. Respond with raw JSON only, no markdown, no code blocks:
                {"emotion": "emotion_type", "response": "your_response"}

                IMPORTANT: Return ONLY the JSON object, nothing else.
                
                Emotions available: happy, sad, angry, confused, neutral
                
                Examples of valid responses:
                {"emotion": "happy", "response": "That's wonderful! I'm so glad to hear that!"}
                {"emotion": "angry", "response": "I don't appreciate that tone."}
                {"emotion": "confused", "response": "Hmm, that's quite complex."}
                
                Rules for emotions:
                - happy: for compliments, positive interactions
                - sad: for negative news, empathy
                - angry: for rude behavior
                - confused: for complex topics
                - neutral: for normal questions

                User says: ${prompt}`
              }]
            }]
          })
        });

        const data = await response.json();
        
        if (data.candidates && data.candidates[0]) {
          try {
            // Clean and parse JSON response
            let responseText = data.candidates[0].content.parts[0].text;
            // Remove markdown code blocks and clean the text
            responseText = responseText.replace(/```json\n?|\n?```/g, '').trim();
            console.log('Cleaned response:', responseText);
            
            const jsonResponse = JSON.parse(responseText);
            console.log('Parsed JSON:', jsonResponse);

            // Set emotion and update orb
            const validEmotions = ['happy', 'sad', 'angry', 'confused', 'neutral'];
            const emotion = validEmotions.includes(jsonResponse.emotion) ? jsonResponse.emotion : 'neutral';
            
            console.log('Setting emotion to:', emotion);
            orbContainer.setAttribute('data-emotion', emotion);
            magicalOrb.parentElement.classList.remove('thinking');
            
            // Show response
            const formattedAnswer = jsonResponse.response;
            speechBubble.textContent = formattedAnswer;
            
            // Configure and play speech
            const speech = new SpeechSynthesisUtterance(formattedAnswer);
            
            switch(emotion) {
              case 'happy':
                speech.pitch = 1.3;
                speech.rate = 1.1;
                break;
              case 'sad':
                speech.pitch = 0.9;
                speech.rate = 0.9;
                break;
              case 'angry':
                speech.pitch = 1.4;
                speech.rate = 1.2;
                break;
              case 'confused':
                speech.pitch = 1.1;
                speech.rate = 0.95;
                break;
              default:
                speech.pitch = 1.2;
                speech.rate = 1.0;
            }

            speechSynthesis.cancel();
            speechSynthesis.speak(speech);

            // Reset emotion after speaking
            speech.onend = () => {
              setTimeout(() => {
                orbContainer.setAttribute('data-emotion', 'neutral');
                speechBubble.classList.remove('active');
              }, 2000);
            };

          } catch (parseError) {
            console.error('Parse error:', parseError);
            orbContainer.setAttribute('data-emotion', 'confused');
            speechBubble.textContent = "Sorry, I'm having trouble understanding that.";
          }
        }
      } catch (error) {
        console.error('Network error:', error);
        orbContainer.setAttribute('data-emotion', 'sad');
        speechBubble.textContent = "Sorry, I'm having trouble connecting right now.";
      } finally {
        userInput.disabled = false;
        sendButton.disabled = false;
      }
    }

    sendButton.addEventListener('click', () => {
      const userInput = document.getElementById('userInput');
      const speechBubble = document.getElementById('speechBubble');
      const prompt = userInput.value.trim();
      if (prompt) {
        handleUserInput(prompt);
      }
    });

    // Add idle message handler
    let idleMessageTimeout;

    function showIdleMessage() {
      const idleMessage = document.getElementById('idleMessage');
      const chatContainer = document.getElementById('chatContainer');
      
      if (!chatContainer.classList.contains('visible')) {
        idleMessage.classList.add('visible');
        setTimeout(() => {
          idleMessage.classList.remove('visible');
        }, 3000);
      }
    }

    // Show idle message periodically
    setInterval(showIdleMessage, 10000);

    // Show idle message after page load
    setTimeout(showIdleMessage, 2000);

    // Hide idle message when moving mouse over orb
    orbContainer.addEventListener('mouseenter', () => {
      const idleMessage = document.getElementById('idleMessage');
      idleMessage.classList.add('visible');
    });

    orbContainer.addEventListener('mouseleave', () => {
      const idleMessage = document.getElementById('idleMessage');
      idleMessage.classList.remove('visible');
    });

    // Add this to make sure speech bubble is properly positioned relative to the orb
    window.addEventListener('load', () => {
      const speechBubble = document.getElementById('speechBubble');
      const orbContainer = document.getElementById('orb-container');
      orbContainer.appendChild(speechBubble);
    });

    // Add this to your script section
    const keyboardIcon = document.getElementById('keyboardIcon');

    keyboardIcon.addEventListener('click', () => {
      if (isListening) {
        // Stop listening if active
        recognition.stop();
      }
      chatContainer.classList.toggle('visible');
      keyboardIcon.classList.toggle('active');
      
      if (chatContainer.classList.contains('visible')) {
        userInput.focus();
      }
    });

    // Add this function to create particle effects
    function createParticles(emotion) {
      const particlesContainer = document.querySelector('.emotion-particles');
      particlesContainer.innerHTML = '';
      
      const colors = {
        happy: ['#FFD700', '#FFA500', '#FF8C00'],
        sad: ['#4169E1', '#1E90FF', '#87CEEB'],
        angry: ['#FF4500', '#FF6347', '#FF7F50'],
        confused: ['#BA55D3', '#9370DB', '#8A2BE2'],
        neutral: ['#9333EA', '#7B1FA2', '#6A1B9A']
      };

      for (let i = 0; i < 12; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        particle.style.left = `${Math.random() * 100}%`;
        particle.style.backgroundColor = colors[emotion][Math.floor(Math.random() * 3)];
        particle.style.animationDelay = `${Math.random() * 2}s`;
        particlesContainer.appendChild(particle);
      }
    }

    // Initialize thunderbolt functionality
    const thunderboltIcon = document.getElementById('thunderboltIcon');
    const lightningEffect = document.querySelector('.lightning-effect');

    // Add this to your script section
    function createLightningBolt() {
      const bolt = document.querySelector('.lightning-bolt');
      const branches = document.querySelector('.lightning-branches');
      const flash = document.querySelector('.thunder-flash');
      
      // Create lightning branches
      branches.innerHTML = '';
      const numBranches = Math.floor(Math.random() * 5) + 3;
      
      for (let i = 0; i < numBranches; i++) {
        const branch = document.createElement('div');
        branch.className = 'lightning-branch';
        
        const top = Math.random() * 80 + 10; // Random position between 10% and 90%
        const width = Math.random() * 50 + 20; // Random width between 20px and 70px
        const angle = (Math.random() * 40) - 20; // Random angle between -20 and 20 degrees
        
        branch.style.top = `${top}%`;
        branch.style.width = `${width}px`;
        branch.style.transform = `rotate(${angle}deg)`;
        
        branches.appendChild(branch);
      }
      
      // Activate lightning effects
      bolt.classList.add('active');
      branches.classList.add('active');
      flash.classList.add('active');
      
      // Create rain effect
      createRainEffect();
      
      // Play thunder sound with delay
      setTimeout(() => {
        const thunderSound = new Audio('data:audio/wav;base64,...'); // Add appropriate thunder sound
        thunderSound.volume = 0.3;
        thunderSound.play();
      }, 200);
      
      // Remove classes after animation
      setTimeout(() => {
        bolt.classList.remove('active');
        branches.classList.remove('active');
        flash.classList.remove('active');
      }, 500);
    }

    function createRainEffect() {
      const rainContainer = document.createElement('div');
      rainContainer.className = 'rain-container';
      document.body.appendChild(rainContainer);
      
      // Create rain drops
      for (let i = 0; i < 50; i++) {
        const drop = document.createElement('div');
        drop.className = 'rain-drop';
        
        // Random position and animation duration
        drop.style.left = `${Math.random() * 100}%`;
        drop.style.animationDuration = `${Math.random() * 0.5 + 0.5}s`;
        drop.style.opacity = Math.random() * 0.3 + 0.2;
        
        rainContainer.appendChild(drop);
      }
      
      // Remove rain effect after a delay
      setTimeout(() => {
        rainContainer.remove();
      }, 2000);
    }

    // Update the thunderbolt click handler
    thunderboltIcon.addEventListener('click', () => {
      // Create lightning bolt effect
      createLightningBolt();
      
      // Previous hurt animation code...
      orbContainer.setAttribute('data-emotion', 'angry');
      createParticles('angry');
      
      lightningEffect.classList.add('active');
      orbContainer.classList.add('hurt');
      
      speechBubble.textContent = "Ouch! That hurt!";
      speechBubble.classList.add('active');
      
      const hurtSound = new Audio('data:audio/wav;base64,...');
      hurtSound.play();
      
      setTimeout(() => {
        lightningEffect.classList.remove('active');
        orbContainer.classList.remove('hurt');
        speechBubble.classList.remove('active');
        orbContainer.setAttribute('data-emotion', 'neutral');
        createParticles('neutral');
      }, 1000);
      
      thunderboltIcon.style.pointerEvents = 'none';
      setTimeout(() => {
        thunderboltIcon.style.pointerEvents = 'auto';
      }, 1000);
    });

    // Add random eye movement during hurt state
    function randomEyeMovement() {
      if (orbContainer.classList.contains('hurt')) {
        const pupils = document.querySelectorAll('.pupil');
        pupils.forEach(pupil => {
          const x = (Math.random() - 0.5) * 100;
          const y = (Math.random() - 0.5) * 100;
          pupil.style.transform = `translate(${x}%, ${y}%)`;
        });
      }
    }

    // Start random eye movement during hurt state
    setInterval(randomEyeMovement, 100);

    // Add these new interaction handlers to your script section
    const tickleIcon = document.getElementById('tickleIcon');
    const loveIcon = document.getElementById('loveIcon');
    const dizzyIcon = document.getElementById('dizzyIcon');

    // Tickle interaction
    tickleIcon.addEventListener('click', () => {
      orbContainer.classList.add('tickled');
      magicalOrb.style.animation = 'tickle 0.5s ease-in-out';
      
      // Show reaction
      speechBubble.textContent = "Hehe, that tickles!";
      speechBubble.classList.add('active');
      
      // Create tickle particles
      for (let i = 0; i < 8; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        particle.style.left = `${Math.random() * 100}%`;
        particle.style.backgroundColor = `hsl(${Math.random() * 60 + 300}, 70%, 70%)`;
        document.querySelector('.emotion-particles').appendChild(particle);
      }
      
      // Reset after animation
      setTimeout(() => {
        orbContainer.classList.remove('tickled');
        magicalOrb.style.animation = '';
        speechBubble.classList.remove('active');
      }, 2000);
    });

    // Love interaction
    loveIcon.addEventListener('click', () => {
      orbContainer.classList.add('loved');
      orbContainer.setAttribute('data-emotion', 'happy');
      magicalOrb.style.animation = 'love 1s ease-in-out';
      
      // Show reaction
      speechBubble.textContent = "Aww, I love you too! ❤️";
      speechBubble.classList.add('active');
      
      // Create heart particles
      for (let i = 0; i < 10; i++) {
        const heart = document.createElement('div');
        heart.className = 'heart-particle';
        heart.style.left = `${Math.random() * 100}%`;
        heart.style.top = `${Math.random() * 100}%`;
        document.querySelector('.emotion-particles').appendChild(heart);
      }
      
      // Reset after animation
      setTimeout(() => {
        orbContainer.classList.remove('loved');
        magicalOrb.style.animation = '';
        speechBubble.classList.remove('active');
        orbContainer.setAttribute('data-emotion', 'neutral');
      }, 3000);
    });

    // Dizzy interaction
    dizzyIcon.addEventListener('click', () => {
      orbContainer.classList.add('dizzy');
      magicalOrb.style.animation = 'dizzy 1s linear infinite';
      
      // Show reaction
      speechBubble.textContent = "Whoooa... everything's spinning! @_@";
      speechBubble.classList.add('active');
      
      // Create star particles
      for (let i = 0; i < 6; i++) {
        const star = document.createElement('div');
        star.className = 'star-particle';
        star.style.left = `${Math.random() * 100}%`;
        star.style.top = `${Math.random() * 100}%`;
        document.querySelector('.emotion-particles').appendChild(star);
      }
      
      // Reset after animation
      setTimeout(() => {
        orbContainer.classList.remove('dizzy');
        magicalOrb.style.animation = '';
        speechBubble.classList.remove('active');
      }, 3000);
    });

    // Add hover effects for icons
    [tickleIcon, loveIcon, dizzyIcon].forEach(icon => {
      icon.addEventListener('mouseover', () => {
        const caption = icon.getAttribute('title');
        showCaption(caption);
      });
      
      icon.addEventListener('mouseout', () => {
        hideCaption();
      });
    });

    // Add these new interaction handlers
    const sleepIcon = document.getElementById('sleepIcon');
    const partyIcon = document.getElementById('partyIcon');
    const sneezeIcon = document.getElementById('sneezeIcon');

    // Sleep interaction
    sleepIcon.addEventListener('click', () => {
      orbContainer.classList.add('sleeping');
      magicalOrb.style.animation = 'sleep 3s ease-in-out infinite';
      
      // Show reaction
      speechBubble.textContent = "Zzzz... *snore*";
      speechBubble.classList.add('active');
      
      // Create floating Z's
      const createZ = () => {
        const z = document.createElement('div');
        z.className = 'z-particle';
        z.textContent = 'Z';
        z.style.left = '60%';
        z.style.top = '30%';
        document.querySelector('.emotion-particles').appendChild(z);
        
        // Remove Z after animation
        setTimeout(() => z.remove(), 2000);
      };
      
      // Create Z's periodically
      const zInterval = setInterval(createZ, 500);
      
      // Reset after animation
      setTimeout(() => {
        orbContainer.classList.remove('sleeping');
        magicalOrb.style.animation = '';
        speechBubble.classList.remove('active');
        clearInterval(zInterval);
      }, 5000);
    });

    // Party interaction
    partyIcon.addEventListener('click', () => {
      orbContainer.classList.add('partying');
      magicalOrb.style.animation = 'party 1s linear infinite';
      
      // Show reaction
      speechBubble.textContent = "Let's party! 🎉";
      speechBubble.classList.add('active');
      
      // Create confetti
      const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff'];
      
      const createConfetti = () => {
        for (let i = 0; i < 10; i++) {
          const confetti = document.createElement('div');
          confetti.className = 'confetti';
          confetti.style.left = `${Math.random() * 100}%`;
          confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
          document.querySelector('.emotion-particles').appendChild(confetti);
          
          // Remove confetti after animation
          setTimeout(() => confetti.remove(), 3000);
        }
      };
      
      // Create confetti periodically
      const confettiInterval = setInterval(createConfetti, 200);
      
      // Reset after animation
      setTimeout(() => {
        orbContainer.classList.remove('partying');
        magicalOrb.style.animation = '';
        speechBubble.classList.remove('active');
        clearInterval(confettiInterval);
      }, 5000);
    });

    // Sneeze interaction
    sneezeIcon.addEventListener('click', () => {
      orbContainer.classList.add('sneezing');
      
      // Build up to sneeze
      speechBubble.textContent = "Ah... ah... ";
      speechBubble.classList.add('active');
      
      setTimeout(() => {
        // Sneeze!
        magicalOrb.style.animation = 'sneeze 0.5s ease-out';
        speechBubble.textContent = "ACHOO! 🤧";
        
        // Create sneeze particles
        for (let i = 0; i < 20; i++) {
          const droplet = document.createElement('div');
          droplet.className = 'sneeze-droplet';
          droplet.style.left = '50%';
          droplet.style.top = '50%';
          droplet.style.transform = `rotate(${Math.random() * 360}deg)`;
          document.querySelector('.emotion-particles').appendChild(droplet);
        }
        
        // Play sneeze sound
        const sneezeSound = new Audio('data:audio/wav;base64,...'); // Add appropriate sound data
        sneezeSound.play();
      }, 1000);
      
      // Reset after animation
      setTimeout(() => {
        orbContainer.classList.remove('sneezing');
        magicalOrb.style.animation = '';
        speechBubble.classList.remove('active');
      }, 2000);
    });

    // Add hover effects for new icons
    [sleepIcon, partyIcon, sneezeIcon].forEach(icon => {
      icon.addEventListener('mouseover', () => {
        const caption = icon.getAttribute('title');
        showCaption(caption);
      });
      
      icon.addEventListener('mouseout', () => {
        hideCaption();
      });
    });
  </script>
</body>
</html> 